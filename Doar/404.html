<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cadastro - IDV</title>
    <link rel="stylesheet" href="/Doar/404.css">
</head>
<body>

<h1>Cadastro de Doadores - IDV</h1>

<form id="cadastroForm" novalidate>
    <fieldset>
        <legend>Informações Pessoais</legend>

        <label for="nome">Nome Completo</label>
        <input type="text" id="nome" name="nome" required placeholder="Ex: Maria da Silva">

        <label for="email">E-mail</label>
        <input type="email" id="email" name="email" required placeholder="email@exemplo.com">

        <label for="cpf">CPF</label>
        <input type="text" id="cpf" name="cpf" required maxlength="14" placeholder="000.000.000-00">

        <label for="telefone">Telefone</label>
        <input type="text" id="telefone" name="telefone" required maxlength="15" placeholder="(00) 00000-0000">

        <label for="nascimento">Data de Nascimento</label>
        <input type="date" id="nascimento" name="nascimento" required>
    </fieldset>

    <fieldset>
        <legend>Endereço</legend>

        <label for="cep">CEP</label>
        <input type="text" id="cep" name="cep" required maxlength="9" placeholder="00000-000" aria-describedby="cepHelp">

        <small id="cepHelp" aria-live="polite"></small>

        <label for="endereco">Endereço (Rua, nº, complemento)</label>
        <input type="text" id="endereco" name="endereco" required placeholder="Rua, nº, bairro">

        <label for="cidade">Cidade</label>
        <input type="text" id="cidade" name="cidade" required>

        <label for="estado">Estado</label>
        <select id="estado" name="estado" required>
            <option value="">Selecione</option>
            <option value="AC">AC</option>
            <option value="AL">AL</option>
            <option value="AP">AP</option>
            <option value="AM">AM</option>
            <option value="BA">BA</option>
            <option value="CE">CE</option>
            <option value="DF">DF</option>
            <option value="ES">ES</option>
            <option value="GO">GO</option>
            <option value="MA">MA</option>
            <option value="MT">MT</option>
            <option value="MS">MS</option>
            <option value="MG">MG</option>
            <option value="PA">PA</option>
            <option value="PB">PB</option>
            <option value="PR">PR</option>
            <option value="PE">PE</option>
            <option value="PI">PI</option>
            <option value="RJ">RJ</option>
            <option value="RN">RN</option>
            <option value="RS">RS</option>
            <option value="RO">RO</option>
            <option value="RR">RR</option>
            <option value="SC">SC</option>
            <option value="SP">SP</option>
            <option value="SE">SE</option>
            <option value="TO">TO</option>
        </select>
    </fieldset>

    <button type="submit">Cadastrar</button>
</form>

<script>
/* --- Máscaras básicas --- */
const cpf = document.getElementById("cpf");
const telefone = document.getElementById("telefone");
const cep = document.getElementById("cep");

cpf.addEventListener("input", () => {
    let v = cpf.value.replace(/\D/g, "");
    v = v.replace(/(\d{3})(\d)/, "$1.$2");
    v = v.replace(/(\d{3})(\d)/, "$1.$2");
    v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
    cpf.value = v;
});

telefone.addEventListener("input", () => {
    let v = telefone.value.replace(/\D/g, "");
    v = v.replace(/^(\d{2})(\d)/, "($1) $2");
    v = v.replace(/(\d{5})(\d)/, "$1-$2");
    telefone.value = v;
});

cep.addEventListener("input", () => {
    let v = cep.value.replace(/\D/g, "");
    v = v.replace(/(\d{5})(\d)/, "$1-$2");
    cep.value = v;
});

/* --- Busca automática de endereço usando ViaCEP --- */
/* Quando o CEP estiver no formato 00000-000 (9 chars) ou 8 dígitos, faz a busca */
const enderecoInput = document.getElementById("endereco");
const cidadeInput = document.getElementById("cidade");
const estadoSelect = document.getElementById("estado");
const cepHelp = document.getElementById("cepHelp");

async function buscarCEP(cepLimpo) {
    cepHelp.textContent = "Buscando endereço...";
    try {
        const res = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
        if (!res.ok) throw new Error("Erro na requisição");
        const data = await res.json();
        if (data.erro) {
            cepHelp.textContent = "CEP não encontrado.";
            return null;
        }
        cepHelp.textContent = "Endereço encontrado.";
        return data; // { logradouro, bairro, localidade, uf, ... }
    } catch (err) {
        cepHelp.textContent = "Não foi possível buscar o CEP (verifique a internet).";
        return null;
    }
}

cep.addEventListener("blur", async () => {
    const cepLimpo = cep.value.replace(/\D/g, "");
    if (cepLimpo.length !== 8) {
        cepHelp.textContent = "Digite um CEP válido com 8 números.";
        return;
    }

    const data = await buscarCEP(cepLimpo);
    if (data) {
        // Preenche apenas se o campo estiver vazio ou se quiser sobrescrever
        // Aqui preenche endereço com logradouro + bairro (você pode ajustar)
        if (data.logradouro) {
            // Se você quiser preencher só rua + número separado, coloque apenas logradouro
            enderecoInput.value = data.logradouro + (data.bairro ? ", " + data.bairro : "");
        } else {
            enderecoInput.value = data.bairro || "";
        }
        cidadeInput.value = data.localidade || "";
        estadoSelect.value = data.uf || "";
    }
});

/* --- Validação nativa adicional antes do submit (opcional) --- */
const form = document.getElementById("cadastroForm");
form.addEventListener("submit", (e) => {
    if (!form.checkValidity()) {
        // Deixa o navegador mostrar mensagens nativas
        e.preventDefault();
        form.reportValidity();
        return;
    }

    // Aqui você pode enviar por fetch para um servidor ou apenas mostrar um alerta
    e.preventDefault(); // remove se quiser realmente enviar
    alert("Formulário válido! (aqui você faria o envio)");
});
</script>

</body>
</html>
